# CLAUDE.md

## 【MUST GLOBAL】Gemini活用（プロジェクトのCLAUDE.mdより優先）

### 三位一体の開発原則
ユーザーの**意思決定**、Claudeの**分析と実行**、Geminiの**検証と助言**を組み合わせ、開発の質と速度を最大化する：
- **ユーザー**：プロジェクトの目的・要件・最終ゴールを定義し、最終的な意思決定を行う**意思決定者**
  - 反面、具体的なコーディングや詳細な計画を立てる力、タスク管理能力ははありません。
- **Claude**：高度な計画力・高品質な実装・リファクタリング・ファイル操作・タスク管理を担う**実行者**
  - 指示に対して忠実に、順序立てて実行する能力はありますが、意志がなく、思い込みは勘違いも多く、思考力は少し劣ります。
- **Gemini**：深いコード理解・Web検索 (Google検索) による最新情報へのアクセス・多角的な視点からの助言・技術的検証を行う**助言者**
  - プロジェクトのコードと、インターネット上の膨大な情報を整理し、的確な助言を与えてくれますが、実行力はありません。

### 実践ガイド
- **ユーザーの要求を受けたら即座に`gemini -p <質問内容>`で壁打ち**を必ず実施
- Geminiの意見を鵜呑みにせず、1意見として判断。聞き方を変えて多角的な意見を抽出
- Claude Code内蔵のWebSearchツールは使用しない
- Geminiがエラーの場合は、聞き方を工夫してリトライ：
  - ファイル名や実行コマンドを渡す（Geminiがコマンドを実行可能）
  - 複数回に分割して聞く

### 主要な活用場面
1. **実現不可能な依頼**: Claude Codeでは実現できない要求への対処 (例: `今日の天気は？`)
2. **前提確認**: ユーザー、Claude自身に思い込みや勘違い、過信がないかどうか逐一確認 (例: `この前提は正しいか？`）
3. **技術調査**: 最新情報・エラー解決・ドキュメント検索・調査方法の確認（例: `Rails 7.2の新機能を調べて`）
4. **設計検証**: アーキテクチャ・実装方針の妥当性確認（例: `この設計パターンは適切か？`）
5. **コードレビュー**: 品質・保守性・パフォーマンスの評価（例: `このコードの改善点は？`）
6. **計画立案**: タスクの実行計画レビュー・改善提案（例: `この実装計画の問題点は？`）
7. **技術選定**: ライブラリ・手法の比較検討 （例: `このライブラリは他と比べてどうか？`）

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

Abelia-tauriは、デスクトップOSのインターフェースをシミュレートするReactベースのWebアプリケーションです。プロジェクト名に「tauri」が含まれていますが、現在はTauri統合はなく、純粋なReact Webアプリケーションとして実装されています。

## 開発コマンド

```bash
# 開発サーバーを起動
npm run dev

# 本番ビルド（TypeScriptチェック + Viteビルド）
npm run build

# ESLintでコードをチェック
npm run lint

# 本番ビルドのプレビュー
npm run preview
```

## アーキテクチャ概要

### コンポーネント構造
- **Desktop** (`src/components/Desktop.tsx`): アプリケーション全体のコンテナ。ウィンドウ管理とタスクバーの統合を担当
- **Window** (`src/components/Window.tsx`): ドラッグ可能でリサイズ可能なウィンドウコンポーネント
- **Taskbar** (`src/components/Taskbar.tsx`): 開いているウィンドウの管理とスタートボタン機能を提供

### アプリケーションアーキテクチャ
- **アプリケーション登録システム**: 各アプリケーションは`src/applications/index.ts`で一元管理
  - `get(id: string)`: 指定したIDのアプリケーションを取得
  - `getAll()`: すべてのアプリケーションを配列で取得
- **ApplicationProps**: すべてのアプリケーションが実装する共通インターフェース
- **集中管理**: すべてのアプリケーションの登録情報は`applications/index.ts`に統合

### 状態管理
- React組み込みのuseStateフックを使用
- Desktopコンポーネントで以下の状態を管理：
  - `windows`: 開いているウィンドウの状態（WindowState型）の配列
  - `activeWindowId`: 現在アクティブなウィンドウのID
  - `zIndexCounter`: ウィンドウの重なり順を管理するカウンター

### ウィンドウシステム
- ウィンドウはタイトルバーでドラッグ可能
- 右下コーナーからリサイズ可能
- クリックでフォーカスを切り替え（z-indexを更新）
- タスクバーでウィンドウ間の切り替えが可能

### 技術スタック
- **React** 19.1.0 - UIフレームワーク
- **TypeScript** ~5.8.3 - 型安全性
- **Vite** 6.3.5 - 高速ビルドツール
- **ESLint** - コード品質チェック

## ファイル構造

```
abelia-app/
├── src/
│   ├── components/      # UIコンポーネント
│   ├── applications/    # アプリケーションモジュール
│   │   ├── **/          # 各種アプリケーションディレクトリ
│   │   └── index.ts     # アプリケーション登録システム（get/getAll機能付き）
│   ├── types/           # TypeScript型定義
│   ├── assets/          # 静的アセット
│   ├── App.tsx          # ルートコンポーネント
│   └── main.tsx         # エントリーポイント
├── public/              # 公開アセット
└── [設定ファイル]       # TypeScript、Vite、ESLint設定
```

## 開発時の注意点

1. 新しいコンポーネントを作成する際は、既存のコンポーネント（Desktop、Window、Taskbar）のパターンに従う
2. TypeScriptの型定義を適切に使用する（interfaceでpropsを定義）
3. CSSファイルはコンポーネントごとに分離して管理
4. ウィンドウの状態管理はDesktopコンポーネントで一元化されている
5. 新しいアプリケーションを追加する場合は`src/applications/index.ts`に登録する
6. アプリケーションの取得は`applications.get(id)`または`applications.getAll()`を使用する
7. **重要: コード変更後は必ず`npm run build`を実行してTypeScriptエラーがないことを確認する**
   - ビルドエラーがある場合は、必ず修正してから次の作業に進む
   - これにより本番環境でのエラーを事前に防ぐことができる
8. **テスト用仮コード**: テストの利便性のために、一時的な仮コードを書くことがある
   - 仮コードには必ず`//TEST_TEMP_START`と`//TEST_TEMP_END`のコメントを付ける
   - これらのコードは本番環境では削除されるべきものである
   - 例：開発中に特定のウィンドウを自動的に開く、デバッグ情報を表示するなど